const defaultSupportedbyPositConfig = {
  'lightBg': "#404041",
  'lightText': "#ffffff",
  'lightLt': "#ee6331",
  'lightGt': "#447099",
  'darkBg': "#404041",
  'darkText': "#ffffff",
  'darkLt': "#ee6331",
  'darkGt': "#447099",
};

// Get configuration when script loads
const supportedByPositConfig = {...defaultSupportedbyPositConfig, ...document.currentScript.dataset };

function addSupportedByPositBadge(config) {

    // Remove existing element, if any
    const existingSupportedByPositElement = document.getElementById('supported-by-posit');
    if (existingSupportedByPositElement) {
      console.log("Removing existing element")
      existingSupportedByPositElement.remove();
    }

    const navElement = document.querySelector('nav.navbar');
    const navbarContainerElement = document.querySelector('.navbar-container.container-fluid');

    if (navElement && navbarContainerElement) {
        navElement.style.paddingRight = '0px';
        navbarContainerElement.style.paddingRight = '0px';

        const headerHeight = navElement.offsetHeight;

        const styles = `
        #logo-supported-by, #logo-text { fill: ${config.lightText}; }
        #logo-mark-lt { fill: ${config.lightLt}; }
        #logo-mark-gt { fill: ${config.lightGt}; }

        #supported-by-posit {
          display: flex;
          justify-content: center;
          align-items: center;
          order: 9999;

          margin-top: -100px;
          margin-bottom: -100px;
          margin-right: 20px;
          margin-left: 10px;

          width: 90px;
          height: calc(${headerHeight}px - 16px);

          background-color: ${config.lightBg};
          border-radius: 4px;
        }

        header.headroom--frozen #supported-by-posit {
          display: flex !important;
          margin: 8.5px;
        }

        #supported-by-posit:hover {
          box-shadow: 0px 0px 2px rgba(21, 21, 21, 0.05), 0px 2px 4px rgba(21, 21, 21, 0.06);
        }

        body.quarto-dark #supported-by-posit { background-color: ${config.darkBg}; }
        body.quarto-dark #supported-by-posit:hover { background-color: #2C2C2D; }
        body.quarto-dark #logo-supported-by, body.quarto-dark #logo-text { fill: ${config.darkText}; }
        body.quarto-dark #logo-mark-lt { fill: ${config.darkLt}; }
        body.quarto-dark #logo-mark-gt { fill: ${config.darkGt}; }
        `

        const styleElement = document.createElement('style');
        styleElement.textContent = styles;
        document.head.appendChild(styleElement);

        const supportedByPositElement = document.createElement('a');
        supportedByPositElement.setAttribute('aria-label', 'Supported by Posit');
        supportedByPositElement.href = 'https://posit.co';
        supportedByPositElement.id = 'supported-by-posit';
        supportedByPositElement.target = '_blank';
        supportedByPositElement.title = 'Supported by Posit';
        supportedByPositElement.classList.add('d-none', 'd-lg-flex');

        const svgTemplate = document.createElement('template');
        svgTemplate.innerHTML = `
          <?xml version="1.0" encoding="UTF-8"?>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 676.88 313.77">
            <g id="logo-supported-by">
              <path d="M42.31,57.36c0,5.76-1.96,10.11-5.89,13.06-3.93,2.94-9.56,4.42-16.91,4.42-3.99,0-7.46-.21-10.4-.64-2.94-.43-5.95-1.21-9.02-2.35v-14.86c2.88,1.27,6.04,2.31,9.47,3.13,3.43.82,6.5,1.23,9.19,1.23,4.02,0,6.03-.92,6.03-2.75,0-.95-.56-1.8-1.69-2.54-1.12-.74-4.39-2.19-9.81-4.34-4.94-2.03-8.39-4.33-10.35-6.91-1.96-2.58-2.94-5.85-2.94-9.81,0-5,1.93-8.9,5.79-11.68,3.86-2.79,9.32-4.18,16.38-4.18,3.55,0,6.88.39,10,1.16,3.12.78,6.36,1.91,9.71,3.4l-5.03,11.97c-2.47-1.11-5.08-2.05-7.84-2.83-2.75-.77-5-1.16-6.74-1.16-3.04,0-4.56.74-4.56,2.23,0,.92.53,1.7,1.59,2.35,1.06.65,4.12,1.97,9.19,3.96,3.77,1.55,6.58,3.07,8.43,4.56,1.85,1.49,3.21,3.24,4.08,5.25.87,2.01,1.31,4.46,1.31,7.34Z"/>
              <path d="M90.94,73.89l-2.33-6.7h-1.09c-1.55,2.47-3.71,4.36-6.48,5.67-2.77,1.31-6.02,1.97-9.76,1.97-5.92,0-10.53-1.72-13.82-5.15-3.29-3.43-4.94-8.29-4.94-14.55V20.09h18.57v29.39c0,3.51.5,6.17,1.5,7.98,1,1.8,2.64,2.71,4.92,2.71,3.2,0,5.48-1.26,6.84-3.78,1.36-2.52,2.04-6.77,2.04-12.75v-23.55h18.57v53.8h-14.01Z"/>
              <path d="M150.06,74.84c-2.72,0-5.16-.45-7.31-1.35-2.15-.9-4.29-2.52-6.41-4.87h-.85c.57,3.77.85,6.11.85,7.03v21.61h-18.57V20.09h15.1l2.61,6.84h.85c3.45-5.19,8.22-7.79,14.29-7.79s10.62,2.47,14.01,7.41c3.39,4.94,5.08,11.71,5.08,20.32s-1.77,15.5-5.29,20.49c-3.53,4.99-8.32,7.48-14.37,7.48ZM143.84,33.72c-2.72,0-4.63.97-5.72,2.92-1.09,1.95-1.69,4.84-1.78,8.67v1.47c0,4.62.62,7.96,1.85,10.02,1.23,2.06,3.18,3.09,5.84,3.09,2.37,0,4.1-1.02,5.18-3.06,1.08-2.04,1.61-5.42,1.61-10.14s-.54-7.94-1.61-9.95c-1.08-2.01-2.87-3.02-5.37-3.02Z"/>
              <path d="M212.6,74.84c-2.72,0-5.16-.45-7.31-1.35-2.15-.9-4.29-2.52-6.41-4.87h-.85c.57,3.77.85,6.11.85,7.03v21.61h-18.57V20.09h15.1l2.61,6.84h.85c3.45-5.19,8.22-7.79,14.29-7.79s10.62,2.47,14.01,7.41c3.39,4.94,5.08,11.71,5.08,20.32s-1.77,15.5-5.29,20.49c-3.53,4.99-8.32,7.48-14.37,7.48ZM206.38,33.72c-2.72,0-4.63.97-5.72,2.92-1.09,1.95-1.69,4.84-1.78,8.67v1.47c0,4.62.62,7.96,1.85,10.02,1.23,2.06,3.18,3.09,5.84,3.09,2.37,0,4.1-1.02,5.18-3.06,1.08-2.04,1.61-5.42,1.61-10.14s-.54-7.94-1.61-9.95c-1.08-2.01-2.87-3.02-5.37-3.02Z"/>
              <path d="M294.23,46.87c0,8.8-2.37,15.66-7.1,20.59-4.73,4.92-11.36,7.38-19.87,7.38s-14.67-2.52-19.49-7.55c-4.83-5.03-7.24-11.84-7.24-20.42s2.37-15.58,7.1-20.44c4.73-4.86,11.37-7.29,19.92-7.29,5.29,0,9.96,1.12,14.01,3.37,4.05,2.25,7.18,5.47,9.38,9.66,2.2,4.2,3.3,9.09,3.3,14.7ZM259.37,46.87c0,4.62.62,8.14,1.85,10.57,1.23,2.42,3.31,3.63,6.22,3.63s4.92-1.21,6.1-3.63c1.19-2.42,1.78-5.94,1.78-10.57s-.6-8.06-1.8-10.4c-1.2-2.34-3.26-3.51-6.17-3.51s-4.89,1.16-6.13,3.49c-1.23,2.33-1.85,5.8-1.85,10.42Z"/>
              <path d="M337.3,19.14c1.61,0,3.15.13,4.61.38l1.04.19-1.66,17.52c-1.52-.38-3.63-.57-6.32-.57-4.05,0-7,.93-8.83,2.78-1.84,1.85-2.75,4.52-2.75,8v26.45h-18.57V20.09h13.82l2.9,8.6h.9c1.55-2.85,3.71-5.15,6.48-6.91,2.77-1.76,5.56-2.64,8.38-2.64Z"/>
              <path d="M376.81,60.17c2.5,0,5.49-.62,8.98-1.85v13.53c-2.5,1.08-4.88,1.84-7.15,2.3-2.26.46-4.92.69-7.95.69-6.24,0-10.73-1.53-13.49-4.58-2.75-3.05-4.13-7.75-4.13-14.08v-22.18h-6.51v-7.55l8.26-5.84,4.8-11.3h12.16v10.78h13.2v13.91h-13.2v20.94c0,3.48,1.68,5.22,5.03,5.22Z"/>
              <path d="M421.16,74.84c-8.96,0-15.92-2.38-20.87-7.15-4.96-4.76-7.43-11.55-7.43-20.35s2.29-16.06,6.89-20.92c4.59-4.86,11.14-7.29,19.66-7.29s14.37,2.11,18.78,6.34c4.42,4.23,6.62,10.31,6.62,18.26v8.26h-33.19c.13,3.01,1.23,5.37,3.3,7.08,2.07,1.71,4.9,2.56,8.48,2.56,3.26,0,6.26-.31,9-.93,2.74-.62,5.71-1.67,8.9-3.16v13.34c-2.91,1.49-5.92,2.52-9.02,3.09-3.1.57-6.81.85-11.11.85ZM420.07,31.77c-2.18,0-4.01.69-5.48,2.07-1.47,1.38-2.33,3.54-2.59,6.48h15.96c-.06-2.6-.8-4.67-2.21-6.22-1.41-1.55-3.3-2.33-5.67-2.33Z"/>
              <path d="M472.02,74.84c-3.83,0-7.18-1.09-10.04-3.28-2.87-2.18-5.08-5.4-6.65-9.64-1.57-4.24-2.35-9.2-2.35-14.86,0-8.74,1.76-15.58,5.27-20.51,3.51-4.94,8.34-7.41,14.48-7.41,3.01,0,5.64.6,7.91,1.8,2.26,1.2,4.33,3.23,6.2,6.08h.38c-.6-4.21-.9-8.42-.9-12.63V0h18.71v73.89h-14.01l-3.99-6.79h-.71c-3.2,5.16-7.96,7.74-14.29,7.74ZM479.62,60.17c2.98,0,5.07-.93,6.29-2.8,1.22-1.87,1.88-4.75,1.97-8.64v-1.47c0-4.75-.68-8.13-2.04-10.14-1.36-2.01-3.5-3.02-6.41-3.02-2.44,0-4.33,1.15-5.67,3.44s-2.02,5.56-2.02,9.81.68,7.36,2.04,9.54c1.36,2.18,3.31,3.28,5.84,3.28Z"/>
              <path d="M575.97,19.14c5.86,0,10.5,2.45,13.94,7.36,3.43,4.91,5.15,11.7,5.15,20.37s-1.73,15.58-5.2,20.54c-3.47,4.96-8.29,7.43-14.46,7.43-2,0-3.77-.21-5.32-.64-1.55-.43-2.94-1.02-4.16-1.78-1.22-.76-2.64-2.03-4.25-3.8h-1.14l-2.94,5.27h-14.48V0h18.57v16.72c0,1.99-.22,5.43-.67,10.3h.67c1.8-2.79,3.89-4.8,6.24-6.03,2.36-1.23,5.04-1.85,8.05-1.85ZM569.18,33.72c-2.6,0-4.5.9-5.7,2.71s-1.8,4.64-1.8,8.5v2.61c0,4.4.6,7.56,1.8,9.47,1.2,1.92,3.17,2.87,5.89,2.87,2.18,0,3.86-1.12,5.03-3.35,1.17-2.23,1.76-5.52,1.76-9.85,0-8.64-2.33-12.96-6.98-12.96Z"/>
              <path d="M599.14,20.09h19.56l9.12,30.87c.44,1.61.74,3.56.9,5.84h.38c.25-2.18.63-4.1,1.14-5.75l9.36-30.96h18.95l-21.27,57.22c-2.72,7.28-6.07,12.43-10.04,15.43-3.97,3.01-9.16,4.51-15.55,4.51-2.47,0-5-.27-7.6-.81v-14.58c1.68.38,3.59.57,5.75.57,1.65,0,3.09-.32,4.32-.95,1.23-.63,2.31-1.53,3.23-2.68.92-1.16,1.9-3.05,2.94-5.67l-21.18-53.04Z"/>
            </g>
            <g id="logo-text">
              <path d="M375.26,177.16c30.96,0,52.79,21.08,52.79,50.36s-21.82,50.18-52.79,50.18-52.42-21.08-52.42-50.18,21.45-50.36,52.42-50.36M375.26,252.52c14.74,0,24.81-9.33,24.81-25s-11.19-25.18-24.81-25.18-24.44,9.14-24.44,25.18c0,14.18,9.89,25,24.44,25"/>
              <path d="M547.03,137.5c8.77,0,15.11,6.28,15.11,14.57,0,8.71-6.34,14.98-15.11,14.98-9.51,0-15.3-6.27-15.3-14.98s6.34-14.57,15.3-14.57M533.41,178.99h27.05v97h-27.05v-97Z"/>
              <path d="M572.67,178.99h18.47v-22.57h27.05v22.57h29.23v25.18h-29.23v31.52c0,11.75,2.61,16.23,9.89,16.23,6.34,0,11.38-2.24,16.6-6.34l13.78,17.08c-6.72,7.09-19.75,14.44-32.99,14.44-20.33,0-34.32-11.01-34.32-33.39v-39.55h-18.47v-25.18h-.01Z"/>
              <path d="M519.41,190.85c-6.63-6.36-20.38-14.58-39.91-14.58-27.81,0-44.17,11.5-44.17,30.36,0,29.27,46.62,29.98,57.63,36.44,1.99,1.11,3.17,2.66,2.46,4.91-2.07,6.49-28.2,9.66-47.47-8.97l-15.72,18.74c7,9.27,22.44,20.15,47.49,20.15,23.27,0,43.39-9.43,43.39-30.92,0-19.27-17.95-27.02-33.91-31.56-4.54-1.25-8.93-2.28-12.73-3.3-6.29-1.61-14.72-3.42-13.37-8.12,2.45-8.54,30.5-3.19,40.31,5.79l16.03-18.93h-.03Z"/>
              <path d="M217.53,179.22h27.09v5.05c5.04-4.67,14.2-7.1,21.68-7.1,29.52,0,47.84,20.37,47.84,49.15s-19.06,51.57-48.59,51.57c-9.34,0-17.94-1.49-20.93-4.86v40.74h-27.09v-134.55h0ZM244.62,213.41v31.02c2.99,4.48,9.53,8.22,17.19,8.22,15.14,0,24.29-9.53,24.29-24.29,0-17.19-8.59-25.97-22.8-25.97-8.97,0-15.13,4.48-18.68,11.02"/>
              <path d="M676.88,187.36c0,4.85-3.81,8.65-8.76,8.65s-8.81-3.81-8.81-8.65,3.91-8.55,8.81-8.55,8.76,3.81,8.76,8.55ZM661.5,187.36c0,3.81,2.81,6.83,6.67,6.83s6.52-3.02,6.52-6.78-2.76-6.88-6.57-6.88-6.62,3.08-6.62,6.83ZM666.77,191.84h-1.98v-8.55c.78-.16,1.88-.26,3.28-.26,1.62,0,2.35.26,2.97.63.47.36.83,1.04.83,1.88,0,.94-.73,1.67-1.77,1.98v.1c.83.31,1.3.94,1.56,2.08.26,1.3.42,1.82.63,2.14h-2.14c-.26-.31-.42-1.09-.68-2.08-.16-.94-.68-1.36-1.77-1.36h-.94v3.44h.01ZM666.82,186.99h.94c1.09,0,1.98-.36,1.98-1.25,0-.78-.57-1.3-1.82-1.3-.52,0-.89.05-1.09.1v2.45h0Z"/>
            </g>
            <g id="logo-mark-lt">
              <polygon points="35.61 207.97 43.62 204.4 79.84 188.26 87.74 184.74 175.24 145.73 175.24 192.78 139.86 207.97 131.86 204.4 168.85 188.51 168.85 155.64 95.64 188.26 87.74 191.79 51.67 207.86 43.67 211.43 18.15 222.8 18.15 231.24 43.28 242.45 51.28 246.02 88.3 262.51 96.16 266.01 168.85 298.41 168.85 265.19 132.25 249.48 140.26 245.91 175.24 260.93 175.24 308.31 88.33 269.57 80.48 266.07 43.23 249.48 35.22 245.91 11.75 235.44 11.75 218.61 35.61 207.97"/>
              <polygon points="95.89 226.85 131.81 211.43 123.8 207.86 79.57 226.85 124.19 246.02 132.19 242.45 95.89 226.85"/>
            </g>
            <g id="logo-mark-gt">
              <polygon points="43.28 242.45 51.28 246.02 87.74 230.36 79.58 226.85 43.28 242.45"/>
              <polygon points="51.67 207.86 43.67 211.43 79.58 226.85 87.74 223.35 51.67 207.86"/>
              <polygon points="139.86 207.97 131.86 204.4 95.64 188.26 87.74 184.74 .24 145.73 .24 192.78 35.61 207.97 43.62 204.4 6.63 188.51 6.63 155.64 79.84 188.26 87.74 191.79 123.81 207.86 131.81 211.43 157.33 222.8 157.33 231.24 132.2 242.45 124.2 246.02 87.18 262.51 79.32 266.01 6.63 298.41 6.63 265.19 43.23 249.48 35.22 245.91 .24 260.93 .24 308.31 87.15 269.57 95 266.07 132.25 249.48 140.26 245.91 163.73 235.44 163.73 218.61 139.86 207.97"/>
            </g>
          </svg>`;

        const svgElement = svgTemplate.content.querySelector('svg');
        svgElement.setAttribute('aria-hidden', 'true');
        svgElement.setAttribute('role', 'presentation');
        svgElement.style.width = '58px';

        supportedByPositElement.appendChild(svgElement);
        navbarContainerElement.appendChild(supportedByPositElement);
    } else {
        console.error('Could not find required elements');
    }
}

document.addEventListener('DOMContentLoaded', () => addSupportedByPositBadge(supportedByPositConfig));
